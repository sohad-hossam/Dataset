If the XAResourceRecoveryHelper returns a different XAResource and isSameRM does not function correctly for the resource manager it is possible that the _xidScans can contain older XAResources which may cache old Xids so should not be scanned
This is evidenced in linked bugzilla: https://bugzilla.redhat.com/show_bug.cgi?id=979058

I can see in the logs on 979058 that we are trying to call rollback on the same XID, this is coming from an older XAResource reference that has cached the Xid reference in the original scan but wasn't expired by the stale check.

It appears to have been re introduced after 4.17.3.Final as that version does not exhibit the same behavior. Fix is to revert most of: https://github.com/jbosstm/narayana/commit/fc1ce60d8b7cd0f0193350537775b13016c743fe

