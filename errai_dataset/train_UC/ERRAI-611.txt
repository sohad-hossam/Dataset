ID generation can cause side effects including JPA lifecycle events and adding entites to the peristence context
In the test class GlobalEntityListenerTest, tests sometimes fail because of spurious post load event, potentially caused by side-effects from other JPA tests.

The tests will pass if this class is run on its own. This only happens when the whole test suite is run in an order that leaves Album instances in the localStorage of the HTMLUnit browser. Failed on Fedora 18 when all Errai-JPA-Client tests were run under surefire.

Here is the stack trace at the time of the offending PostLoad event. Notice the event was delivered as a side effect of probing for an existing entity ID (the call to LongIdGenerator.next()).

java.lang.Exception
	at org.jboss.errai.jpa.test.entity.TestingGlobalEntityListener.postLoad(TestingGlobalEntityListener.java:33)
	at org.jboss.errai.jpa.client.local.GeneratedErraiEntityManagerFactory$101.deliverPostLoad(GeneratedErraiEntityManagerFactory.java:6900)
	at org.jboss.errai.jpa.client.local.GeneratedErraiEntityManagerFactory$101.deliverPostLoad(GeneratedErraiEntityManagerFactory.java:1)
	at org.jboss.errai.jpa.client.local.ErraiEntityManager.find(ErraiEntityManager.java:593)
	at org.jboss.errai.jpa.client.local.ErraiEntityType.parseSingularJsonReference(ErraiEntityType.java:461)
	at org.jboss.errai.jpa.client.local.ErraiEntityType.fromJson(ErraiEntityType.java:184)
	at org.jboss.errai.jpa.client.local.backend.WebStorageBackend.get(WebStorageBackend.java:109)
	at org.jboss.errai.jpa.client.local.ErraiEntityManager.find(ErraiEntityManager.java:588)
	at org.jboss.errai.jpa.client.local.ErraiEntityManager.find(ErraiEntityManager.java:575)
	at org.jboss.errai.jpa.client.local.LongIdGenerator.next(LongIdGenerator.java:43)
	at org.jboss.errai.jpa.client.local.LongIdGenerator.next(LongIdGenerator.java:1)
	at org.jboss.errai.jpa.client.local.ErraiEntityManager.generateAndSetLocalId(ErraiEntityManager.java:167)
	at org.jboss.errai.jpa.client.local.ErraiEntityManager.keyFor(ErraiEntityManager.java:343)
	at org.jboss.errai.jpa.client.local.ErraiEntityManager.applyCascadingOperation(ErraiEntityManager.java:181)
	at org.jboss.errai.jpa.client.local.ErraiEntityManager.persist(ErraiEntityManager.java:539)
	at org.jboss.errai.jpa.test.client.GlobalEntityListenerTest.testMultipleEntityTypesLifecycle(GlobalEntityListenerTest.java:109)
	at org.jboss.errai.jpa.test.client.__GlobalEntityListenerTest_unitTestImpl.doRunTest(__GlobalEntityListenerTest_unitTestImpl.java:7)
	at junit.framework.TestCase.runTest(TestCase.java:62)
	at com.google.gwt.junit.client.GWTTestCase.runBare(GWTTestCase.java:188)
	at com.google.gwt.junit.client.GWTTestCase.__doRunTest(GWTTestCase.java:129)
	at com.google.gwt.junit.client.impl.GWTRunner.runTest(GWTRunner.java:390)
	at com.google.gwt.junit.client.impl.GWTRunner.doRunTest(GWTRunner.java:318)
	at com.google.gwt.junit.client.impl.GWTRunner.access$9(GWTRunner.java:312)
	at com.google.gwt.junit.client.impl.GWTRunner$TestBlockListener.onSuccess(GWTRunner.java:107)
	at com.google.gwt.junit.client.impl.GWTRunner$TestBlockListener.onSuccess(GWTRunner.java:1)
	at com.google.gwt.user.client.rpc.impl.RequestCallbackAdapter.onResponseReceived(RequestCallbackAdapter.java:232)
	at com.google.gwt.http.client.Request.fireOnResponseReceived(Request.java:258)
	at com.google.gwt.http.client.RequestBuilder$1.onReadyStateChange(RequestBuilder.java:412)
	at sun.reflect.GeneratedMethodAccessor121.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.google.gwt.dev.shell.MethodAdaptor.invoke(MethodAdaptor.java:103)
	at com.google.gwt.dev.shell.MethodDispatch.invoke(MethodDispatch.java:71)
	at com.google.gwt.dev.shell.OophmSessionHandler.invoke(OophmSessionHandler.java:172)
	at com.google.gwt.dev.shell.BrowserChannelServer.reactToMessagesWhileWaitingForReturn(BrowserChannelServer.java:338)
	at com.google.gwt.dev.shell.BrowserChannelServer.invokeJavascript(BrowserChannelServer.java:219)
	at com.google.gwt.dev.shell.ModuleSpaceOOPHM.doInvoke(ModuleSpaceOOPHM.java:136)
	at com.google.gwt.dev.shell.ModuleSpace.invokeNative(ModuleSpace.java:571)
	at com.google.gwt.dev.shell.ModuleSpace.invokeNativeObject(ModuleSpace.java:279)
	at com.google.gwt.dev.shell.JavaScriptHost.invokeNativeObject(JavaScriptHost.java:91)
	at com.google.gwt.core.client.impl.Impl.apply(Impl.java)
	at com.google.gwt.core.client.impl.Impl.entry0(Impl.java:249)
	at sun.reflect.GeneratedMethodAccessor120.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at com.google.gwt.dev.shell.MethodAdaptor.invoke(MethodAdaptor.java:103)
	at com.google.gwt.dev.shell.MethodDispatch.invoke(MethodDispatch.java:71)
	at com.google.gwt.dev.shell.OophmSessionHandler.invoke(OophmSessionHandler.java:172)
	at com.google.gwt.dev.shell.BrowserChannelServer.reactToMessages(BrowserChannelServer.java:293)
	at com.google.gwt.dev.shell.BrowserChannelServer.processConnection(BrowserChannelServer.java:547)
	at com.google.gwt.dev.shell.BrowserChannelServer.run(BrowserChannelServer.java:364)
	at java.lang.Thread.run(Thread.java:724)
